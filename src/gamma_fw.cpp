#include "gamma_fw.h"
#include "fe_firmware.h"


Gamma_fw::Gamma_fw(uint32_t inpins, uint32_t outpins, const char* inst_name):fw_base(inpins, outpins, inst_name)
{
    bypass = 0;
}

void Gamma_fw::fw_init()
{
    log_info("%s init run start\n", name);
    cfgEntry_t config[] = {
        {"bypass",                       UINT_32,          &this->bypass                }
    };
    for (int i = 0; i < sizeof(config) / sizeof(cfgEntry_t); i++)
    {
        this->fwCfgList.push_back(config[i]);
    }

    log_info("%s init run end\n", name);
}

void Gamma_fw::fw_exec(statistic_info_t* stat_in, global_ref_out_t* global_ref_out, 
    uint32_t frame_cnt, void* pipe_regs)
{
    fe_module_reg_t* regs = (fe_module_reg_t*)pipe_regs;
    dng_md_t* all_dng_md = global_ref_out->meta_data;
    gamma_reg_t* gamma_reg = &(regs->gamma_reg);

    gamma_reg->bypass = 0;
    uint16_t gamma_22[257] = {
     0,   201,   398,   591,   781,   967,  1149,  1328,  1504,  1677,
  1846,  2012,  2175,  2335,  2492,  2646,  2797,  2945,  3091,  3234,
  3374,  3512,  3647,  3780,  3911,  4039,  4165,  4288,  4410,  4530,
  4647,  4763,  4877,  4989,  5099,  5207,  5314,  5420,  5524,  5626,
  5727,  5827,  5926,  6023,  6120,  6215,  6309,  6403,  6495,  6587,
  6678,  6768,  6858,  6947,  7036,  7124,  7212,  7299,  7386,  7473,
  7559,  7644,  7729,  7814,  7898,  7981,  8064,  8146,  8228,  8309,
  8389,  8469,  8548,  8627,  8705,  8782,  8858,  8934,  9009,  9083,
  9157,  9230,  9302,  9373,  9443,  9513,  9582,  9650,  9717,  9783,
  9849,  9913,  9977, 10041, 10103, 10165, 10226, 10286, 10346, 10405,
 10464, 10521, 10578, 10635, 10691, 10746, 10801, 10855, 10909, 10962,
 11015, 11067, 11118, 11170, 11220, 11271, 11320, 11370, 11419, 11467,
 11516, 11564, 11611, 11658, 11705, 11752, 11798, 11844, 11890, 11935,
 11980, 12025, 12070, 12114, 12158, 12202, 12245, 12288, 12331, 12374,
 12416, 12458, 12500, 12542, 12583, 12625, 12665, 12706, 12746, 12787,
 12826, 12866, 12906, 12945, 12984, 13023, 13061, 13099, 13137, 13175,
 13213, 13250, 13288, 13325, 13361, 13398, 13434, 13470, 13506, 13542,
 13578, 13613, 13649, 13684, 13719, 13753, 13788, 13822, 13856, 13891,
 13925, 13958, 13992, 14026, 14059, 14092, 14125, 14159, 14191, 14224,
 14257, 14290, 14322, 14355, 14387, 14419, 14451, 14483, 14515, 14547,
 14579, 14611, 14643, 14674, 14706, 14738, 14769, 14801, 14832, 14864,
 14895, 14927, 14958, 14989, 15021, 15052, 15083, 15115, 15146, 15178,
 15209, 15240, 15272, 15303, 15335, 15366, 15398, 15430, 15461, 15493,
 15525, 15557, 15588, 15620, 15652, 15685, 15717, 15749, 15781, 15814,
 15846, 15879, 15912, 15945, 15978, 16011, 16044, 16077, 16111, 16144,
 16178, 16212, 16246, 16280, 16314, 16349, 16383
    };
    //uint16_t gamma_log[257] = {
    //     2038,  4190,  5176,  5885,  6455,  6939,  7366,  7737,  8057,  8340,
    //     8594,  8822,  9031,  9224,  9402,  9568,  9723,  9868, 10005, 10135,
    //    10259, 10376, 10488, 10594, 10697, 10795, 10889, 10979, 11067, 11151,
    //    11233, 11311, 11388, 11462, 11533, 11603, 11671, 11736, 11800, 11863,
    //    11924, 11983, 12041, 12097, 12153, 12207, 12259, 12311, 12362, 12411,
    //    12460, 12507, 12554, 12600, 12645, 12689, 12732, 12774, 12816, 12857,
    //    12898, 12937, 12976, 13015, 13053, 13090, 13127, 13163, 13198, 13233,
    //    13268, 13302, 13336, 13369, 13401, 13434, 13466, 13497, 13528, 13559,
    //    13589, 13619, 13648, 13677, 13706, 13734, 13762, 13790, 13818, 13845,
    //    13872, 13898, 13924, 13950, 13976, 14002, 14027, 14052, 14076, 14101,
    //    14125, 14149, 14172, 14196, 14219, 14242, 14265, 14287, 14310, 14332,
    //    14354, 14375, 14397, 14418, 14440, 14461, 14481, 14502, 14522, 14543,
    //    14563, 14583, 14602, 14622, 14642, 14661, 14680, 14699, 14718, 14736,
    //    14755, 14773, 14792, 14810, 14828, 14846, 14863, 14881, 14898, 14916,
    //    14933, 14950, 14967, 14984, 15001, 15017, 15034, 15050, 15067, 15083,
    //    15099, 15115, 15131, 15146, 15162, 15178, 15193, 15208, 15224, 15239,
    //    15254, 15269, 15284, 15298, 15313, 15328, 15342, 15357, 15371, 15385,
    //    15399, 15414, 15428, 15441, 15455, 15469, 15483, 15496, 15510, 15523,
    //    15537, 15550, 15563, 15576, 15590, 15603, 15616, 15628, 15641, 15654,
    //    15667, 15679, 15692, 15704, 15717, 15729, 15741, 15754, 15766, 15778,
    //    15790, 15802, 15814, 15826, 15837, 15849, 15861, 15872, 15884, 15896,
    //    15907, 15918, 15930, 15941, 15952, 15964, 15975, 15986, 15997, 16008,
    //    16019, 16030, 16041, 16051, 16062, 16073, 16083, 16094, 16105, 16115,
    //    16126, 16136, 16146, 16157, 16167, 16177, 16187, 16198, 16208, 16218,
    //    16228, 16238, 16248, 16258, 16268, 16277, 16287, 16297, 16307, 16316,
    //    16326, 16335, 16345, 16355, 16364, 16373, 16383 };
    for(int32_t i=0; i<257; i++)
    {
        gamma_reg->gamma_lut[i] = gamma_22[i];
        //gamma_reg.gamma_lut[i] = gamma_log[i];
    }
}

Gamma_fw::~Gamma_fw()
{

}